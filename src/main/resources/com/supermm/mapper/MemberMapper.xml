<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.supermm.mapper.MemberMapper">

	<!-- 회원목록 -->
	<select id="getMemList" resultType="com.supermm.model.MemberVO">
		select * from member where order by mnum
	</select>

	<!-- 검색조건 -->
	<sql id="criteria">
		<trim prefix="AND (" suffix=")" prefixOverrides="OR">
			<foreach collection="searchTypeArr" item="searchType">
				<trim prefix="OR">
					<choose>
						<when test="searchType == 'N'.toString()">
							name like '%'||#{keyWord}||'%'
						</when>
						<when test="searchType == 'G'.toString()">
							gender like '%'||#{keyWord}||'%'
						</when>
					</choose>
				</trim>
			</foreach>
		</trim>
	</sql>

	<!-- 회원목록(페이징) -->
	<select id="getMemListPaging"
		resultType="com.supermm.model.MemberVO">
  	<![CDATA[ 
  	select mnum, id, pw, name, birth, gender, email, phone, zipcode, addr1, addr2, addr3, mpoint, regdate from(
		select /*+INDEX_DESC(member mnum) */ rownum rnum, mnum, id, pw, name, birth, gender, email, phone, zipcode, addr1, addr2, addr3, mpoint, regdate
     	from member where rownum <= #{pageNum} * #{amount}
     ]]>
		<if test="keyWord != null">
			<include refid="criteria"></include>
		</if>
     	
	<![CDATA[
		)
		where rnum > (#{pageNum} -1) * #{amount}
	]]>
	</select>

	<!-- 회원 총 인원 -->
	<select id="getMemTotal" resultType="int">
		select count(*) from member
		<if test="keyWord != null">
			where mnum > 0
			<include refid="criteria"></include>
		</if>
	</select>

	<!-- 회원정보 조회 -->
	<select id="getMemInfo" resultType="com.supermm.model.MemberVO">
		select * from member where mnum = #{mnum}
	</select>

	<!-- 회원포인트 수정 -->
	<update id="updateMemPoint">
		update member set mpoint = #{mpoint} where mnum = #{mnum}
	</update>


	<!-- ********************* 클라이언트 ************************ -->
	<!-- 로그인하기 -->
	<select id="memberLogin" resultType="com.supermm.model.MemberVO">
		select id, name, mpoint, adminchk, money from member where id =#{id} and pw
		= #{pw}
	</select>

	<!-- 회원 가입 하기 -->
	<insert id="memberjoin">
		insert into member(mnum, id, pw, name, birth, gender, email, phone, addr1,
		addr2, addr3, regdate, adminchk)
		values(memberSeq.NEXTVAL, #{id}, #{pw}, #{name}, #{birth}, #{gender}, #{email}, #{phone},
		#{addr1}, #{addr2}, #{addr3}, sysdate, 0)
	</insert>

	<!-- 아이디 중복 검사 -->
	<select id="idCheck" resultType="int">
		select count(*) from member where id = #{id}
	</select>

	<!-- 비밀번호 찾기-메일 -->

	<!-- 비빌번호찾기 -->
	<update id="findpw" parameterType="hashMap">
		update member set pw = #{pw} where email =#{email} and id = #{id}
	</update>

	<!-- 비빌번호check -->
	<select id="findpwchk" resultType="int">
		select count(*) from member where email =#{email} and id = #{id}
	</select>

	<!-- 마이페이지 내정보 -->
	<select id="getMyInfo" resultType="com.supermm.model.MemberVO">
		select * from member where
		mnum = #{mnum}
	</select>





</mapper>