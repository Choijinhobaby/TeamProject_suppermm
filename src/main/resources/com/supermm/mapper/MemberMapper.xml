<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.supermm.mapper.MemberMapper">
  	
  	<!-- 회원목록 -->
  	<select id="getMemList" resultType="com.supermm.model.MemberVO">
  		select * from member where order by mnum
  	</select>
  	
  	<!-- 검색조건 -->
	<sql id="criteria">
		<trim prefix="AND (" suffix=")" prefixOverrides="OR">
			<foreach collection="searchTypeArr" item="searchType">
				<trim prefix="OR">
					<choose>
					<when test="searchType == 'N'.toString()">
						name like '%'||#{keyWord}||'%'
					</when>
					<when test="searchType == 'G'.toString()">
						gender like '%'||#{keyWord}||'%'
					</when>
				</choose>
				</trim>
			</foreach>
		</trim>
  	</sql>
  	
  	<!-- 회원목록(페이징) -->
  	<select id="getMemListPaging" resultType="com.supermm.model.MemberVO">
  	<![CDATA[ 
  	select mnum, id, pw, name, birth, gender, email, phone, zipcode, addr1, addr2, addr3, mpoint, regdate from(
		select /*+INDEX_DESC(member mnum) */ rownum rnum, mnum, id, pw, name, birth, gender, email, phone, zipcode, addr1, addr2, addr3, mpoint, regdate
     	from member where rownum <= #{pageNum} * #{amount}
     ]]> 
     	<if test="keyWord != null">
     		<include refid="criteria"></include>
     	</if>
     	
	<![CDATA[
		)
		where rnum > (#{pageNum} -1) * #{amount}
	]]> 
  	</select>
  		
  	<!-- 회원 총 인원 -->
  	<select id="getMemTotal" resultType="int">
  		select count(*) from member
  		<if test="keyWord != null">
  			where mnum > 0 <include refid="criteria"></include>
  		</if>
  	</select>

  	<!-- 회원정보 조회 -->
  	<select id="getMemInfo" resultType="com.supermm.model.MemberVO">
  		select * from member where mnum = #{mnum}
  	</select>
  	
  	<!-- 회원포인트 수정 -->
  	<update id="updateMemPoint" >
  		update member set mpoint = #{mpoint} where mnum = #{mnum}
  	</update>
  	
  	
  </mapper>