<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.supermm.mapper.ProductMapper">

	<!-- 상품목록  -->
	<select id="getProdList" resultType="com.supermm.model.ProductVO">
		select * from product order by pNum	
	</select>
	
	<!-- 검색조건 -->
	<sql id="criteria">
	    <if test="searchType =='N'.toString()">
		    pname like '%'||#{keyWord}||'%'and
		</if>
		<if test="searchType =='C'.toString()">
		    pcategory_fk1 like '%'||#{keyWord}||'%'and
		</if>
	</sql>
	
	<!--  상품목록(페이징)  -->
	<select id="getProdListPaging" resultType="productVO">
		select 
		pnum, pcategory_fk1, pname, pimage, pcompany, pspec, pqty, price, ppoint, pcontent
		from( select /*+INDEX_DESC(product pnum) */
		rownum rnum, pnum, pcategory_fk1, pname, pimage, pcompany, pspec, pqty, price, ppoint, pcontent from product where
	<include refid="criteria"/>
		<![CDATA[ rownum <= #{pageNum} * #{amount} ]]>
		order by pnum)
		<![CDATA[ where rnum > (#{pageNum} -1) * #{amount} ]]>
		order by pnum
	</select>
	
	<!-- 상품 총 개수 -->
	<select id="getProdTotal" resultType="Integer">
		select count(*) total from product where
		<include refid="criteria"></include>
		pnum > 0
	</select>
	
	<!-- 상품등록 -->
	<insert id="prodInput" parameterType="ProductVO">
	    insert into product(pnum, pcategory_fk1, pname, pimage, pcompany, pspec, pqty, price, ppoint)
	    values (productseq.NEXTVAL, #{pcategory_fk1, jdbcType=VARCHAR}, #{pname}, #{pimage}, #{pcompany}, #{pspec}, #{pqty}, #{price}, #{ppoint})
	</insert>
  
  	<!-- 카테고리 리스트 -->
  	<select id="cateList" resultType="com.supermm.model.CategoryVO">
  		select * from category order by catecode
  	</select>
  	
  	<!-- 상품 삭제 -->
  	<delete id="prodDelete">
  		delete from product where pnum = #{pnum}
  	</delete>
  	
  	<!--  상품 수정  -->
	<update id="prodUpdate" parameterType="productVO">
		update product set 
		pcategory_fk1=#{pcategory_fk1}, pname=#{pname}, pimage=#{pimage},
		pcompany=#{pcompany}, pspec=#{pspec}, pqty=#{pqty}, price=#{price}, ppoint=#{ppoint}, pcontent=#{pcontent}
		where pnum=#{pnum}
	</update>
	
	
	<!--   상품 (수정)상세내용   -->
	<select id="prodDetail" resultType="productVO">
		select * from product where pnum = #{pnum}
	</select>
   
   
   <!-- ************************ 클라이언트 ************************* -->

	
  </mapper>